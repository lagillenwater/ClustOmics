README
Created by resle
--------------------------------------------------------------------------------------------------

Purpose

To create a batch adjusted TMM normalized counts using voom.

Methods

We incorporated cpm function to filter for genes that had a low count.

we applied cpm function to the DGE object and obtained the sum of the rows and filtered out any gene that had less than 10 counts total. (min_samples_filter parameter)

i.e.:

keep <- rowSums(cpm(DGE_object) > 1) >= min_samples_filter
  DGE_object <- DGE_object[keep, , keep.lib.sizes=FALSE]
  return(DGE_object)

Prereq

1. Merged counts file (/udd/resle/repos/dev/created by write_COPD_limma_batch_makefile.R)
2. /udd/resle/repos/dev/create_normalized_counts.R script

Scripts used:

1. write_COPD_limma_batch_makefile.R

This script is normally used to create a makefile that is used to run differential analyses. When creating a makefile, it also generates a merged count file. 

   - Use any method to merge all of the counts into one matrix, specifically used this script to merge the counts.
   - used write_COPD_limma_batch_makefile.R using a batch file that only ontains Lc.Batch
   - ex: /proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/batch_file.txt
   - Used these parameters:
   - write_COPD_limma_batch_makefile(
      analysis_dir  = '/proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/',
      script_dir    = '/udd/resle/repos/prod/Differential_expression/',
      counts_dir    = '/proj/regeps/regep00/studies/COPDGene/data/rnaseq/BLOOD/QCed_data/Counts/FREEZE3/Rsubread_gene/Grch38_stranded_autosomeXY/individual/',
      pheno_file    = '/proj/regeps/regep00/studies/COPDGene/data/pheno/COPDGene_P2_30feb19.csv',
      batch_file    = '/proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/batch_file.tsv',
      master_file   = '/proj/regeps/regep00/studies/COPDGene/data/rnaseq/BLOOD/archivalroot/Masterfile/master.file.freeze3.without.nonsmokers.txt'
    )

2. create_normalized_counts.R

This script is taken from limma_genes.R script. After using voom, $E command (extracting E element from the Voom object) was used to extract the noramlized counts. (i.e. normalized_counts <- voom_object$E)

used these parameters:

   - output_folder = desired output folder, (i.e. /proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/)
   - pheno_file = /proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/Lc.Batch/pheno_file.tsv
   - count_file = /proj/regeps/regep00/studies/COPDGene/analyses/resle/Differential_analyses/FREEZE3/DE_Genes_Counts/master_counts_table.tsv
   - design_string = ~Lc.Batch
   - min_samples_filter = 10
   - do_sva = F 